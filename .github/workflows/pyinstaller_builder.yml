name: Package Applications with Pyinstaller

on:
  workflow_dispatch:

jobs:
  build:

    runs-on: windows-latest

    steps:
    - name: Clone this repository
      uses: actions/checkout@master

    - uses: actions/setup-python@master
      with:
        python-version: '3.8' # Version range or exact version of a Python version to use, using SemVer's version range syntax
        architecture: 'x86' # optional x64 or x86. Defaults to x64 if not specified

    - name: Install the requirements for the GUI
      run: |
        python -m pip install --upgrade pip
        python -m pip install -r requirements.txt

    - name: Install PyInstaller
      run: python -m pip install --upgrade pyinstaller

    - name: Build the first package (EEG anonymiser, anonymiser.exe)
      run: >
        pyinstaller -F --workpath ./build --distpath ./dist
        --specpath ./ --clean -n anonymiser
        --icon=./ico/fpms_anonymous.ico ./anonymiser.py

    - name: Build the second package (converter, coh3toEDF.exe)
      run: >
        pyinstaller -F --workpath ./build --distpath ./dist
        --specpath ./ --clean -n coh3toEDF
        --icon=./ico/fpms.ico ./coh3toEDF.py
    
    - name: Generate the anonymiser GUI Python script from the .ui file
      run: python .\ui_to_py_converter.py .\anonymiser_gui.ui .\anonymiser_gui.py

    - name: Build the third package (EEG anonymiser GUI, coh3toEDF.exe)
      run: >
        pyinstaller.exe -F --workpath ./build --distpath ./dist
        --specpath ./ --clean -n EEG_anonymiser
        --icon=./ico/fpms_anonymous.ico
        --add-data './ico/;ico' .\gui_anonymiser_main.pyw

    - name: Upload the artefact (coh3toEDF.exe)
      uses: actions/upload-artifact@v2
      with:
        name: Executables
        path: |
            ./dist/*.exe
            ./*.config

